<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste: Card√°pio Digital - Cen√°rio Real</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .food-item { transition: transform 0.2s; }
        .food-item:hover { transform: scale(1.02); }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-md mx-auto bg-white min-h-screen">
        <!-- Header -->
        <div class="bg-red-500 text-white p-4 sticky top-0 z-10">
            <h1 class="text-lg font-bold">üçï Pizzaria do Jo√£o</h1>
            <p class="text-sm opacity-90">Entrega: 30-45 min ‚Ä¢ R$ 3,99</p>
        </div>
        
        <!-- Categorias -->
        <div class="sticky top-16 bg-white border-b p-3 z-9">
            <div class="flex gap-3 overflow-x-auto">
                <button class="category-btn bg-red-100 text-red-600 px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium">
                    üçï Pizzas (12)
                </button>
                <button class="category-btn bg-gray-100 text-gray-600 px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium">
                    ü•§ Bebidas (8)
                </button>
                <button class="category-btn bg-gray-100 text-gray-600 px-4 py-2 rounded-full whitespace-nowrap text-sm font-medium">
                    üç∞ Sobremesas (6)
                </button>
            </div>
        </div>
        
        <!-- Menu -->
        <div class="p-4">
            <h2 class="text-lg font-bold mb-4">üçï Pizzas</h2>
            <div id="pizzas-container"></div>
            
            <h2 class="text-lg font-bold mb-4 mt-8">ü•§ Bebidas</h2>
            <div id="bebidas-container"></div>
            
            <h2 class="text-lg font-bold mb-4 mt-8">üç∞ Sobremesas</h2>
            <div id="sobremesas-container"></div>
        </div>
        
        <!-- Performance Metrics -->
        <div class="fixed bottom-4 left-4 right-4 bg-black bg-opacity-75 text-white p-3 rounded-lg text-xs">
            <div id="metrics"></div>
        </div>
    </div>

    <script type="module">
        const startTime = performance.now();
        let metricsData = {
            totalItems: 26,
            initiallyVisible: 0,
            imagesLoaded: 0,
            timeToFirstImage: null,
            timeToViewableContent: null
        };
        
        function updateMetrics() {
            const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);
            const metrics = document.getElementById('metrics');
            metrics.innerHTML = `
                <div><strong>‚è±Ô∏è Tempo:</strong> ${elapsed}s</div>
                <div><strong>üëÅÔ∏è Vis√≠veis:</strong> ${metricsData.initiallyVisible}/${metricsData.totalItems}</div>
                <div><strong>üñºÔ∏è Carregadas:</strong> ${metricsData.imagesLoaded}</div>
                <div><strong>üéØ Primeira:</strong> ${metricsData.timeToFirstImage || '-'}s</div>
                <div><strong>‚úÖ Tela inicial:</strong> ${metricsData.timeToViewableContent || '-'}s</div>
            `;
        }
        
        // Mock data - card√°pio t√≠pico
        const menuData = {
            pizzas: [
                { name: 'Margherita', desc: 'Mussarela, tomate, manjeric√£o', price: 35.90, image: `https://picsum.photos/120/80?random=1` },
                { name: 'Calabresa', desc: 'Calabresa, cebola, azeitona', price: 38.90, image: `https://picsum.photos/120/80?random=2` },
                { name: 'Quatro Queijos', desc: 'Mussarela, parmes√£o, gorgonzola, provolone', price: 42.90, image: `https://picsum.photos/120/80?random=3` },
                { name: 'Portuguesa', desc: 'Presunto, ovos, cebola, ervilha', price: 41.90, image: `https://picsum.photos/120/80?random=4` },
                { name: 'Frango Catupiry', desc: 'Frango desfiado, catupiry', price: 39.90, image: `https://picsum.photos/120/80?random=5` },
                { name: 'Pepperoni', desc: 'Pepperoni, mussarela', price: 44.90, image: `https://picsum.photos/120/80?random=6` },
                { name: 'Vegetariana', desc: 'Abobrinha, berinjela, tomate seco', price: 37.90, image: `https://picsum.photos/120/80?random=7` },
                { name: 'Bacon', desc: 'Bacon, mussarela, cebola', price: 40.90, image: `https://picsum.photos/120/80?random=8` },
                { name: 'Atum', desc: 'Atum, cebola, azeitona', price: 43.90, image: `https://picsum.photos/120/80?random=9` },
                { name: 'Napolitana', desc: 'Mussarela, tomate, parmes√£o', price: 36.90, image: `https://picsum.photos/120/80?random=10` },
                { name: 'Romana', desc: 'Mussarela, tomate, manjeric√£o, r√∫cula', price: 38.90, image: `https://picsum.photos/120/80?random=11` },
                { name: 'Especial da Casa', desc: 'Ingredientes selecionados pelo chef', price: 49.90, image: `https://picsum.photos/120/80?random=12` }
            ],
            bebidas: [
                { name: 'Coca-Cola 350ml', price: 4.50, image: `https://picsum.photos/120/80?random=13` },
                { name: 'Guaran√° 350ml', price: 4.50, image: `https://picsum.photos/120/80?random=14` },
                { name: '√Ågua 500ml', price: 3.00, image: `https://picsum.photos/120/80?random=15` },
                { name: 'Suco Laranja', price: 6.90, image: `https://picsum.photos/120/80?random=16` },
                { name: 'Cerveja Heineken', price: 8.90, image: `https://picsum.photos/120/80?random=17` },
                { name: 'Vinho Tinto', price: 24.90, image: `https://picsum.photos/120/80?random=18` },
                { name: 'Refrigerante 2L', price: 9.90, image: `https://picsum.photos/120/80?random=19` },
                { name: 'Energ√©tico', price: 7.50, image: `https://picsum.photos/120/80?random=20` }
            ],
            sobremesas: [
                { name: 'Pudim', price: 8.90, image: `https://picsum.photos/120/80?random=21` },
                { name: 'Brigadeiro', price: 3.50, image: `https://picsum.photos/120/80?random=22` },
                { name: 'Sorvete', price: 12.90, image: `https://picsum.photos/120/80?random=23` },
                { name: 'Torta Chocolate', price: 15.90, image: `https://picsum.photos/120/80?random=24` },
                { name: 'Mousse Maracuj√°', price: 9.90, image: `https://picsum.photos/120/80?random=25` },
                { name: 'A√ßa√≠ 500ml', price: 18.90, image: `https://picsum.photos/120/80?random=26` }
            ]
        };
        
        function createFoodItem(item, index, useLazy = true) {
            const div = document.createElement('div');
            div.className = 'food-item bg-white rounded-lg border border-gray-200 mb-4 overflow-hidden';
            
            const imageSrc = useLazy ? 
                'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" fill="%23e5e7eb" viewBox="0 0 24 24"%3E%3Cpath d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/%3E%3C/svg%3E' : 
                item.image;
            
            const dataLazySrc = useLazy ? `data-lazy-src="${item.image}"` : '';
            
            div.innerHTML = `
                <div class="flex">
                    <div class="flex-1 p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">${item.name}</h3>
                        ${item.desc ? `<p class="text-sm text-gray-600 mb-2">${item.desc}</p>` : ''}
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-green-600">R$ ${item.price.toFixed(2).replace('.', ',')}</span>
                            <button class="bg-red-500 text-white px-4 py-1 rounded-full text-sm font-medium hover:bg-red-600">
                                Adicionar
                            </button>
                        </div>
                    </div>
                    <div class="w-24 h-20 flex-shrink-0 m-4">
                        <img src="${imageSrc}" ${dataLazySrc} alt="${item.name}" 
                             class="w-full h-full object-cover rounded-lg ${useLazy ? 'lazy-image' : ''}"
                             onload="handleImageLoad(this, ${index})"
                             onerror="handleImageError(this, ${index})">
                    </div>
                </div>
            `;
            
            return div;
        }
        
        window.handleImageLoad = function(img, index) {
            const loadTime = ((performance.now() - startTime) / 1000).toFixed(3);
            metricsData.imagesLoaded++;
            
            if (!metricsData.timeToFirstImage) {
                metricsData.timeToFirstImage = loadTime;
            }
            
            // Check if all visible items are loaded
            if (metricsData.imagesLoaded >= metricsData.initiallyVisible && !metricsData.timeToViewableContent) {
                metricsData.timeToViewableContent = loadTime;
            }
            
            updateMetrics();
        };
        
        window.handleImageError = function(img, index) {
            console.log(`Erro na imagem ${index}`);
        };
        
        // Count initially visible items (approximately first 8-10 items)
        metricsData.initiallyVisible = 8;
        
        // Render menu
        let itemIndex = 0;
        
        // Pizzas (primeiras s√£o vis√≠veis)
        const pizzasContainer = document.getElementById('pizzas-container');
        menuData.pizzas.forEach((item, i) => {
            const foodItem = createFoodItem(item, itemIndex++, true);
            pizzasContainer.appendChild(foodItem);
        });
        
        // Bebidas e sobremesas (n√£o vis√≠veis inicialmente)
        const bebidasContainer = document.getElementById('bebidas-container');
        menuData.bebidas.forEach((item, i) => {
            const foodItem = createFoodItem(item, itemIndex++, true);
            bebidasContainer.appendChild(foodItem);
        });
        
        const sobremesasContainer = document.getElementById('sobremesas-container');
        menuData.sobremesas.forEach((item, i) => {
            const foodItem = createFoodItem(item, itemIndex++, true);
            sobremesasContainer.appendChild(foodItem);
        });
        
        // Initialize lazy loading
        try {
            const { default: lazyLoader } = await import('../src/js/services/lazy-loader.js');
            setTimeout(() => {
                lazyLoader.refresh();
                console.log('üçï Lazy loading ativado para card√°pio digital');
            }, 100);
        } catch (error) {
            console.warn('Lazy loader n√£o dispon√≠vel, carregando todas as imagens');
        }
        
        updateMetrics();
        
        // Simulate user scroll behavior after 3 seconds
        setTimeout(() => {
            console.log('üì± Simulando scroll do usu√°rio...');
            window.scrollTo({ top: 400, behavior: 'smooth' });
        }, 3000);
    </script>
</body>
</html>