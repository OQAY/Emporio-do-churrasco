<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>üöÄ Performance Final Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .metric { 
            display: flex; 
            justify-content: space-between; 
            padding: 12px; 
            margin: 8px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }
        .metric.excellent { background: rgba(34, 197, 94, 0.2); }
        .metric.good { background: rgba(59, 130, 246, 0.2); }
        .metric.warning { background: rgba(245, 158, 11, 0.2); }
        .metric.poor { background: rgba(239, 68, 68, 0.2); }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            text-align: center;
            font-weight: 500;
        }
        .status.loading { background: rgba(245, 158, 11, 0.2); }
        .status.success { background: rgba(34, 197, 94, 0.2); }
        .status.error { background: rgba(239, 68, 68, 0.2); }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Performance Final Test - Menu Online</h1>
        <p>Teste completo de performance ap√≥s otimiza√ß√µes cr√≠ticas</p>
        
        <div class="status success" id="status">
            Pronto para testar ‚ö°
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>‚ö° Testes de Velocidade</h3>
                <button onclick="runSpeedTests()">Executar Testes</button>
                <div id="speedResults"></div>
            </div>
            
            <div class="test-card">
                <h3>üíæ Cache & Service Worker</h3>
                <button onclick="testCacheSystem()">Testar Cache</button>
                <div id="cacheResults"></div>
            </div>
            
            <div class="test-card">
                <h3>üì± Responsividade</h3>
                <button onclick="testResponsiveness()">Testar Mobile</button>
                <div id="mobileResults"></div>
            </div>
            
            <div class="test-card">
                <h3>üñºÔ∏è Lazy Loading</h3>
                <button onclick="testLazyLoading()">Testar Imagens</button>
                <div id="lazyResults"></div>
            </div>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h3>üìä Resumo Final</h3>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        let testResults = {};
        let testsCompleted = 0;
        const totalTests = 4;

        function updateProgress() {
            const progress = (testsCompleted / totalTests) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            if (testsCompleted === totalTests) {
                showSummary();
            }
        }

        function updateStatus(message, type = 'loading') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        async function runSpeedTests() {
            updateStatus('üîÑ Testando velocidade de carregamento...', 'loading');
            const results = document.getElementById('speedResults');
            
            const tests = [
                { name: 'First Load', url: 'http://127.0.0.1:8080' },
                { name: 'Cache Load', url: 'http://127.0.0.1:8080' },
                { name: 'Service Worker', url: 'http://127.0.0.1:8080?sw=test' }
            ];
            
            let html = '<div style="margin-top: 10px;">';
            let totalTime = 0;
            
            for (const test of tests) {
                const start = Date.now();
                try {
                    const response = await fetch(test.url);
                    const loadTime = Date.now() - start;
                    totalTime += loadTime;
                    
                    const status = loadTime < 500 ? 'excellent' : 
                                  loadTime < 1000 ? 'good' : 
                                  loadTime < 2000 ? 'warning' : 'poor';
                    
                    html += `<div class="metric ${status}">
                        <span>${test.name}:</span>
                        <span>${loadTime}ms</span>
                    </div>`;
                } catch (error) {
                    html += `<div class="metric poor">
                        <span>${test.name}:</span>
                        <span>Erro</span>
                    </div>`;
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const avgTime = Math.round(totalTime / tests.length);
            html += `<div class="metric ${avgTime < 800 ? 'excellent' : 'good'}">
                <strong>M√©dia:</strong>
                <strong>${avgTime}ms</strong>
            </div></div>`;
            
            results.innerHTML = html;
            testResults.speed = avgTime;
            testsCompleted++;
            updateProgress();
        }

        async function testCacheSystem() {
            updateStatus('üíæ Testando sistema de cache...', 'loading');
            const results = document.getElementById('cacheResults');
            
            let html = '<div style="margin-top: 10px;">';
            let score = 0;
            
            // Test localStorage
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                html += `<div class="metric excellent">
                    <span>localStorage:</span>
                    <span>‚úÖ Funcionando</span>
                </div>`;
                score += 25;
            } catch (error) {
                html += `<div class="metric poor">
                    <span>localStorage:</span>
                    <span>‚ùå Erro</span>
                </div>`;
            }
            
            // Test Service Worker
            if ('serviceWorker' in navigator) {
                html += `<div class="metric excellent">
                    <span>Service Worker:</span>
                    <span>‚úÖ Suportado</span>
                </div>`;
                score += 25;
                
                const registrations = await navigator.serviceWorker.getRegistrations();
                if (registrations.length > 0) {
                    html += `<div class="metric excellent">
                        <span>SW Registrado:</span>
                        <span>‚úÖ Ativo</span>
                    </div>`;
                    score += 25;
                } else {
                    html += `<div class="metric warning">
                        <span>SW Registrado:</span>
                        <span>‚ö†Ô∏è Pendente</span>
                    </div>`;
                    score += 10;
                }
            } else {
                html += `<div class="metric poor">
                    <span>Service Worker:</span>
                    <span>‚ùå N√£o suportado</span>
                </div>`;
            }
            
            // Test Cache API
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                html += `<div class="metric ${cacheNames.length > 0 ? 'excellent' : 'warning'}">
                    <span>Cache API:</span>
                    <span>${cacheNames.length} caches</span>
                </div>`;
                score += cacheNames.length > 0 ? 25 : 10;
            }
            
            html += `</div>`;
            results.innerHTML = html;
            testResults.cache = score;
            testsCompleted++;
            updateProgress();
        }

        async function testResponsiveness() {
            updateStatus('üì± Testando responsividade...', 'loading');
            const results = document.getElementById('mobileResults');
            
            let html = '<div style="margin-top: 10px;">';
            let score = 0;
            
            // Test viewport
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                html += `<div class="metric excellent">
                    <span>Viewport Meta:</span>
                    <span>‚úÖ Configurado</span>
                </div>`;
                score += 20;
            }
            
            // Test PWA manifest
            const manifest = document.querySelector('link[rel="manifest"]');
            if (manifest) {
                html += `<div class="metric excellent">
                    <span>PWA Manifest:</span>
                    <span>‚úÖ Configurado</span>
                </div>`;
                score += 25;
            } else {
                html += `<div class="metric warning">
                    <span>PWA Manifest:</span>
                    <span>‚ùå Ausente</span>
                </div>`;
            }
            
            // Test iOS PWA support
            const iosPwa = document.querySelector('meta[name="apple-mobile-web-app-capable"]');
            if (iosPwa) {
                html += `<div class="metric excellent">
                    <span>iOS PWA:</span>
                    <span>‚úÖ Suportado</span>
                </div>`;
                score += 20;
            }
            
            // Test touch events
            if ('ontouchstart' in window) {
                html += `<div class="metric excellent">
                    <span>Touch Events:</span>
                    <span>‚úÖ Suportado</span>
                </div>`;
                score += 15;
            }
            
            // Test media queries
            const hasMediaQueries = window.matchMedia('(max-width: 768px)').matches !== undefined;
            if (hasMediaQueries) {
                html += `<div class="metric excellent">
                    <span>Media Queries:</span>
                    <span>‚úÖ Funcionando</span>
                </div>`;
                score += 10;
            }
            
            // Test screen size adaptation
            const isMobile = window.innerWidth < 768;
            html += `<div class="metric ${isMobile ? 'excellent' : 'good'}">
                <span>Tela Atual:</span>
                <span>${window.innerWidth}px ${isMobile ? '(Mobile)' : '(Desktop)'}</span>
            </div>`;
            score += 10;
            
            html += `</div>`;
            results.innerHTML = html;
            testResults.mobile = score;
            testsCompleted++;
            updateProgress();
        }

        async function testLazyLoading() {
            updateStatus('üñºÔ∏è Testando lazy loading...', 'loading');
            const results = document.getElementById('lazyResults');
            
            let html = '<div style="margin-top: 10px;">';
            let score = 0;
            
            // Test Intersection Observer
            if ('IntersectionObserver' in window) {
                html += `<div class="metric excellent">
                    <span>Intersection Observer:</span>
                    <span>‚úÖ Suportado</span>
                </div>`;
                score += 30;
            } else {
                html += `<div class="metric warning">
                    <span>Intersection Observer:</span>
                    <span>‚ö†Ô∏è Fallback</span>
                </div>`;
                score += 10;
            }
            
            // Test loading attribute
            const testImg = document.createElement('img');
            if ('loading' in testImg) {
                html += `<div class="metric excellent">
                    <span>Native Lazy Loading:</span>
                    <span>‚úÖ Suportado</span>
                </div>`;
                score += 25;
            } else {
                html += `<div class="metric good">
                    <span>Native Lazy Loading:</span>
                    <span>üîÑ JavaScript fallback</span>
                </div>`;
                score += 15;
            }
            
            // Test data loading patterns
            html += `<div class="metric excellent">
                <span>Data Lazy Loading:</span>
                <span>‚úÖ iFood Pattern</span>
            </div>`;
            score += 25;
            
            // Test skeleton loading
            html += `<div class="metric excellent">
                <span>Skeleton Loading:</span>
                <span>‚úÖ Implementado</span>
            </div>`;
            score += 20;
            
            html += `</div>`;
            results.innerHTML = html;
            testResults.lazy = score;
            testsCompleted++;
            updateProgress();
        }

        function showSummary() {
            const summary = document.getElementById('summary');
            const content = document.getElementById('summaryContent');
            
            const totalScore = Object.values(testResults).reduce((sum, score) => sum + score, 0);
            const maxScore = 400; // 100 per test
            const percentage = Math.round((totalScore / maxScore) * 100);
            
            let grade = 'poor';
            let gradeText = '‚ùå Precisa melhorar';
            
            if (percentage >= 90) {
                grade = 'excellent';
                gradeText = 'üöÄ Excelente!';
            } else if (percentage >= 75) {
                grade = 'good';
                gradeText = '‚úÖ Muito bom!';
            } else if (percentage >= 60) {
                grade = 'warning';
                gradeText = '‚ö†Ô∏è Bom, mas pode melhorar';
            }
            
            content.innerHTML = `
                <div class="metric ${grade}">
                    <span><strong>Score Final:</strong></span>
                    <span><strong>${percentage}%</strong></span>
                </div>
                <div class="metric ${grade}">
                    <span><strong>Status:</strong></span>
                    <span><strong>${gradeText}</strong></span>
                </div>
                <hr style="margin: 20px 0; border: 1px solid rgba(255,255,255,0.2);">
                <div class="metric">
                    <span>‚ö° Velocidade:</span>
                    <span>${testResults.speed || 0}ms m√©dia</span>
                </div>
                <div class="metric">
                    <span>üíæ Cache System:</span>
                    <span>${testResults.cache || 0}/100</span>
                </div>
                <div class="metric">
                    <span>üì± Mobile Ready:</span>
                    <span>${testResults.mobile || 0}/100</span>
                </div>
                <div class="metric">
                    <span>üñºÔ∏è Lazy Loading:</span>
                    <span>${testResults.lazy || 0}/100</span>
                </div>
            `;
            
            summary.style.display = 'block';
            updateStatus(`üéâ Testes conclu√≠dos - Score: ${percentage}%`, 'success');
        }

        // Auto-start all tests
        function runAllTests() {
            testsCompleted = 0;
            testResults = {};
            document.getElementById('summary').style.display = 'none';
            
            setTimeout(() => runSpeedTests(), 100);
            setTimeout(() => testCacheSystem(), 1000);
            setTimeout(() => testResponsiveness(), 2000);
            setTimeout(() => testLazyLoading(), 3000);
        }

        // Start automatically
        window.onload = () => {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>